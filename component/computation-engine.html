<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Computation Engine — Data Profiler</title>
  <link rel="icon" type="image/png" href="/assets/QbitrixDatalensLogo.ico" />

  <link rel="stylesheet" href="/css/computation.css" />
  <link rel="stylesheet" href="/css/main.css" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
  <header class="qd-header">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <img src="/assets/QbitrixDatalensLogo.png" class="qd-logo" alt="Logo"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" />
        <div class="ms-2 lh-1">
          <div class="fw-bold fs-5" style="letter-spacing: -0.5px;">QBITRIX <span class="text-primary">DataLens</span>
          </div>
          <small class="text-muted" style="font-size: 12px;">Unified Client-Side Data Platform</small>
        </div>
      </div>
      <div>
        <button class="qd-icon-btn" onclick="redirectToPage('/index.html')" title="Home"><i
            class="bi bi-house"></i></button>
        <button class="qd-icon-btn ms-2" onclick="redirectToPage('/component/docs.html')" title="Documentation"><i
            class="bi bi-book"></i></button>
      </div>
    </div>
  </header>
  <div class="qd-toolbar">
    <div class="qd-toolbar-left">
      <h5 class="fw-bold m-0 text-dark">Computation Engine</h5>
    </div>
  </div>
  <nav class="nav-card shadow-sm sticky-top" style="top: 57px; z-index: 1019;">
    <div class="container-fluid px-4">
      <div class="nav-scroll">
        <button class="btn btn-link text-decoration-none section-toggle active" data-section="field-summaries">
          <i class="bi bi-list-ul me-1"></i> Summaries
        </button>
        <button class="btn btn-link text-decoration-none section-toggle" data-section="table">
          <i class="bi bi-table me-1"></i> Table
        </button>
        <button class="btn btn-link text-decoration-none section-toggle" data-section="numeric-stats">
          <i class="bi bi-graph-up me-1"></i> Numeric
        </button>
        <button class="btn btn-link text-decoration-none section-toggle" data-section="text-stats">
          <i class="bi bi-textarea-t me-1"></i> Text
        </button>
        <button class="btn btn-link text-decoration-none section-toggle" data-section="date-stats">
          <i class="bi bi-calendar me-1"></i> Dates
        </button>
        <button class="btn btn-link text-decoration-none section-toggle" data-section="value-counts">
          <i class="bi bi-bar-chart me-1"></i> Value Counts
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid px-4">
    <div class="row g-3 mb-4">
      <div class="col-12 col-xl-4">
        <div class="stat-card">
          <h6 class="stat-label mb-3">Data Ingestion</h6>
          <div id="uploader" class="uploader mb-2">
            <i class="bi bi-cloud-arrow-up fs-3 text-primary"></i>
            <span class="fw-bold small mt-1">Upload CSV / XLSX / JSON</span>
            <input id="fileInput" type="file" accept=".csv,.xlsx,.xls,.json"
              style="position:absolute; inset:0; width:100%; height:100%; opacity:0; cursor:pointer;" />
          </div>
          <div id="fileInfo" class="text-muted" style="font-size: 0.75rem;">No file loaded</div>
        </div>
      </div>

      <div class="col-12 col-xl-8">
        <div class="stat-card">
          <div class="row g-3">
            <div class="col-6 col-md-3 text-center border-end">
              <div class="stat-label">Records</div>
              <div id="statRecords" class="stat-val">0</div>
            </div>
            <div class="col-6 col-md-3 text-center border-end-md">
              <div class="stat-label">Fields</div>
              <div id="statFields" class="stat-val">0</div>
            </div>
            <div class="col-6 col-md-3 text-center border-end">
              <div class="stat-label">Numeric</div>
              <div id="statNumeric" class="stat-val text-primary">0</div>
            </div>
            <div class="col-6 col-md-3 text-center">
              <div class="stat-label">Total Nulls</div>
              <div id="statNulls" class="stat-val text-danger">0</div>
            </div>
          </div>
          <hr>
          <div class="row align-items-center">
            <div class="col-md-7">
              <div class="stat-label mb-2">Type Distribution</div>
              <div class="d-flex flex-wrap gap-3 small fw-bold text-secondary">
                <span>Num: <span id="numericPercent" class="text-dark">0%</span></span>
                <span>Str: <span id="stringPercent" class="text-dark">0%</span></span>
                <span>Date: <span id="datePercent" class="text-dark">0%</span></span>
                <span>Bool: <span id="booleanPercent" class="text-dark">0%</span></span>
              </div>
            </div>
            <div class="col-md-5 mt-3 mt-md-0">
              <div class="stat-label mb-1">Columns Identified</div>
              <div id="columnList" class="small text-truncate text-muted" style="max-width: 100%;">None</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <main>
      <section id="table-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
          <h5 class="fw-bold mb-0">Raw Data Preview</h5>
          <div class="d-flex gap-2">
            <div class="input-group input-group-sm" style="width: 220px;">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input id="globalSearch" class="form-control" placeholder="Search rows...">
            </div>
            <select id="rowsPerPage" class="form-select form-select-sm" style="width: 110px;">
              <option value="10">10 Rows</option>
              <option value="20">20 Rows</option>
              <option value="50">50 Rows</option>
              <option value="100">100 Rows</option>
            </select>
          </div>
        </div>
        <div id="dataTable" class="table-responsive border rounded"></div>
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-3 gap-2">
          <div id="pageInfo" class="small text-muted fw-bold"></div>
          <ul id="pagination" class="pagination pagination-sm mb-0"></ul>
        </div>
      </section>

      <section id="field-summaries-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Field Summaries</h5>
          <button id="exportSummaryBtn" class="btn btn-sm btn-success"><i class="bi bi-download me-1"></i> Export
            Summary</button>
        </div>
        <div id="fieldsSummaryTable" class="table-responsive border rounded"></div>
      </section>

      <section id="numeric-stats-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Numeric Statistics</h5>
          <button id="exportNumericStatsBtn" class="btn btn-sm btn-primary"><i
              class="bi bi-file-earmark-excel me-1"></i> Excel</button>
        </div>
        <div id="numericStatsTable" class="table-responsive border rounded"></div>
      </section>

      <section id="text-stats-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Text Statistics</h5>
          <button id="exportTextStatsBtn" class="btn btn-sm btn-primary"><i class="bi bi-file-earmark-excel me-1"></i>
            Excel</button>
        </div>
        <div id="textStatsTable" class="table-responsive border rounded"></div>
      </section>

      <section id="date-stats-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Date Statistics</h5>
          <button id="exportDateStatsBtn" class="btn btn-sm btn-primary"><i class="bi bi-file-earmark-excel me-1"></i>
            Excel</button>
        </div>
        <div id="dateStatsTable" class="table-responsive border rounded"></div>
      </section>

      <section id="value-counts-section" class="card shadow-sm p-4 mb-4" style="display: none;">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
          <h5 class="fw-bold mb-0">Value Counts</h5>
          <div class="d-flex flex-wrap gap-2">
            <select id="valueCountsFieldSelect" class="form-select form-select-sm" style="width:160px;"></select>
            <select id="rowsPerPageValueCounts" class="form-select form-select-sm" style="width:100px;">
              <option value="10">10 Rows</option>
              <option value="20">20 Rows</option>
              <option value="50">50 Rows</option>
              <option value="100">100 Rows</option>
            </select>
            <button id="exportValueCountsBtn" class="btn btn-sm btn-primary"><i
                class="bi bi-file-earmark-excel"></i></button>
          </div>
        </div>
        <div id="valueCountsTable" class="table-responsive border rounded"></div>
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-3 gap-2">
          <div id="pageInfoValueCounts" class="small text-muted fw-bold"></div>
          <ul id="paginationValueCounts" class="pagination pagination-sm mb-0"></ul>
        </div>
      </section>
    </main>
  </div>
  <footer class="qd-footer text-center">
    <div class="container">
      <p class="mb-1">© 2025 <strong>QBITRIX DataLens</strong>. All rights reserved.</p>
      <small>Crafted by <a href="https://sachinkumarhebri.vercel.app" target="_blank"
          class="text-decoration-none">Sachin Kumar</a></small>
    </div>
  </footer>
  <script>
    AOS.init({ duration: 800, once: true });

    document.addEventListener('DOMContentLoaded', function () {
      const toggles = document.querySelectorAll('.section-toggle');
      const sectionIds = ['table-section', 'field-summaries-section', 'numeric-stats-section', 'text-stats-section', 'date-stats-section', 'value-counts-section'];

      toggles.forEach(btn => {
        btn.addEventListener('click', function () {
          // Update Button UI
          toggles.forEach(t => t.classList.remove('active'));
          this.classList.add('active');

          const sectionPrefix = this.getAttribute('data-section');
          const targetId = sectionPrefix + '-section';

          // Hide all with important to override any JS inline styles from computation.js
          sectionIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.style.setProperty('display', 'none', 'important');
          });

          // Show targeted
          const targetEl = document.getElementById(targetId);
          if (targetEl) {
            targetEl.style.setProperty('display', 'block', 'important');
            // Scroll offset to account for sticky nav
            const offset = 140;
            const bodyRect = document.body.getBoundingClientRect().top;
            const elementRect = targetEl.getBoundingClientRect().top;
            const elementPosition = elementRect - bodyRect;
            const offsetPosition = elementPosition - offset;

            window.scrollTo({
              top: offsetPosition,
              behavior: 'smooth'
            });
          }
        });
      });
    });
  </script>

  <script src="/js/computation/state.js"></script>
  <script src="/js/computation/helpers.js"></script>
  <script src="/js/computation/stats.js"></script>
  <script src="/js/computation/parsing.js"></script>
  <script src="/js/computation/schema.js"></script>
  <script src="/js/computation/data.js"></script>
  <script src="/js/computation/exports.js"></script>
  <script src="/js/computation/events.js"></script>
  <script src="/js/app.js"></script>
</body>

</html>