<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Data Explorer</title>
    <link rel="icon" href="/assets/QbitrixDatalensLogo.ico" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />

    <link href="/css/dataExplorer.css" rel="stylesheet" />
    <link href="/css/main.css" rel="stylesheet" />

</head>

<body>
    <header class="qd-header">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <img src="/assets/QbitrixDatalensLogo.png" class="qd-logo" alt="Logo"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" />
                <div class="ms-2 lh-1">
                    <div class="fw-bold fs-5" style="letter-spacing: -0.5px;">QBITRIX <span
                            class="text-primary">DataLens</span>
                    </div>
                    <small class="text-muted" style="font-size: 12px;">Unified Client-Side Data Platform</small>
                </div>
            </div>
            <div>
                <button class="qd-icon-btn" onclick="redirectToPage('/index.html')" title="Home"><i
                        class="bi bi-house"></i></button>
                <button class="qd-icon-btn ms-2" onclick="redirectToPage('/component/docs.html')"
                    title="Documentation"><i class="bi bi-book"></i></button>
            </div>
        </div>
    </header>
    <div class="qd-toolbar">
        <div class="qd-toolbar-left">
            <h5 class="fw-bold m-0 text-dark">Data Explorer</h5>
        </div>
        <div class="qd-toolbar-right">
            <div class="d-flex align-items-center gap-2">
                <div class="dropdown">
                    <button class="btn btn-outline-dark btn-sm dropdown-toggle px-3" data-bs-toggle="dropdown">
                        <i class="bi bi-download me-1"></i> Export
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                        <li><a class="dropdown-item" id="exportCSVBtn" href="#"><i
                                    class="bi bi-filetype-csv me-2"></i>CSV</a></li>
                        <li><a class="dropdown-item" id="exportExcelBtn" href="#"><i
                                    class="bi bi-file-earmark-excel me-2"></i>Excel</a></li>
                        <li><a class="dropdown-item" id="exportJSONBtn" href="#"><i
                                    class="bi bi-filetype-json me-2"></i>JSON</a></li>
                    </ul>
                </div>

                <button id="resetAllBtn" class="btn btn-outline-danger btn-sm px-3" title="Reset Query">
                    <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
                </button>
            </div>
        </div>
    </div>
    <main class="container-fluid py-4">
        <div class="row g-4">
            <aside class="col-12 col-lg-3">
                <div class="card p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-3">1. Upload Dataset</label>
                        <div id="uploader" class="uploader mb-3 text-center">
                            <i class="bi bi-cloud-arrow-up display-6 text-primary mb-2 d-block"></i>
                            <div class="fw-semibold small">Drag & drop files</div>
                            <small class="text-muted" style="font-size: 0.7rem;">CSV, XLSX, JSON (Max 10MB)</small>
                            <input id="fileInput" type="file" accept=".csv,.xlsx,.xls,.json,.txt,.xml"
                                style="position:absolute; inset:0; width:100%; height:100%; opacity:0; cursor:pointer;" />
                        </div>

                        <div class="d-flex gap-2 mb-3">
                            <button id="loadBtn" class="btn btn-primary flex-grow-1 btn-sm py-2">
                                <i class="bi bi-lightning-charge-fill me-1"></i> Upload
                            </button>
                            <button id="clearDB" class="btn btn-outline-danger btn-sm" title="Clear Data">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <div class="mb-4">
                        <label class="form-label fw-bold small text-uppercase text-muted mb-2">2. Dataset
                            Overview</label>
                        <div id="schemaSummary" class="p-2 border rounded small bg-light text-center">No data loaded
                        </div>

                        <div class="row g-2 mt-2">
                            <div class="col-6">
                                <div class="info-badge text-center">
                                    <small class="d-block text-muted">Rows</small>
                                    <span id="infoRows" class="fw-bold">0</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-badge text-center">
                                    <small class="d-block text-muted">Cols</small>
                                    <span id="infoCols" class="fw-bold">0</span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="info-badge overflow-hidden">
                                    <small class="d-block text-muted">File Name</small>
                                    <div id="infoFilename" class="text-truncate fw-semibold">No file</div>
                                    <small class="text-muted d-none" id="infoMIME">—</small>
                                    <small id="infoSize" class="text-primary fw-bold"
                                        style="font-size: 0.7rem;">—</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label fw-bold small text-uppercase text-muted mb-0">3. Select
                                Columns</label>
                            <button id="selectAllCols"
                                class="btn btn-sm btn-link p-0 text-decoration-none small">All</button>
                        </div>
                        <div id="columnsContainer" class="columns-checkboxes"></div>
                    </div>
                </div>
            </aside>

            <section class="col-12 col-lg-9">
                <div class="card">
                    <div class="card-header bg-white border-bottom">
                        <h6 class="m-0 fw-bold p-2 text-dark"><i class="bi bi-sliders me-2 text-primary"></i>Analyze and
                            visualize
                            your datasets instantly</h6>
                    </div>
                    <div class="p-4">
                        <div class="row align-items-center g-3 mb-4">
                            <div class="col-md-6">
                                <div class="input-group input-group-merge">
                                    <span class="input-group-text bg-light border-end-0"><i
                                            class="bi bi-search text-muted"></i></span>
                                    <input id="globalSearch" class="form-control bg-light border-start-0"
                                        placeholder="Global search across all results..." />
                                </div>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <div class="d-inline-flex align-items-center gap-2">
                                    <small class="text-muted fw-medium">Rows per page:</small>
                                    <select id="pageSizeSel" class="form-select form-select-sm" style="width:100px">
                                        <option value="10" selected>10</option>
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div id="filtersPanel" class="filter-block">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-filter-left me-2"></i>Query Filters</h6>
                                <div class="d-flex gap-2">
                                    <button id="addFilterRuleBtn"
                                        class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                        <i class="bi bi-plus-lg me-1"></i> Add Rule
                                    </button>
                                    <button id="clearAllRulesBtn"
                                        class="btn btn-sm btn-link text-danger text-decoration-none">Clear All</button>
                                </div>
                            </div>

                            <div id="filterRulesArea" class="row g-2 mb-3"></div>

                            <div class="pt-3 border-top d-flex gap-2">
                                <button id="applyFiltersBtn" class="btn btn-success btn-sm px-4">Apply Filters</button>
                                <button id="clearFiltersBtn" class="btn btn-warning btn-sm px-4">Reset
                                    Filter</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-4">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <h5 class="mb-0 fw-bold">Data Results</h5>
                        </div>
                        <div class="badge bg-light text-dark border p-2">
                            <i class="bi bi-stopwatch me-1"></i> <span id="runtime">0 ms</span>
                        </div>
                    </div>

                    <div class="table-wrap mb-3">
                        <table class="table table-hover table-bordered table-sm align-middle mb-0 w-100" id="dataTable">
                            <thead class="table-light">
                            </thead>
                            <tbody class="small">
                            </tbody>
                        </table>
                    </div>

                    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
                        <span class="text-muted small">Showing <span id="showingCount"
                                class="text-dark fw-bold">0</span> records</span>
                        <div class="d-flex gap-2">
                            <button id="downloadViewBtn" class="btn btn-sm btn-outline-success px-3">
                                <i class="bi bi-file-earmark-arrow-down me-1"></i> Download View
                            </button>
                            <button id="copyBtn" class="btn btn-sm btn-outline-secondary" title="Copy to Clipboard">
                                <i class="bi bi-clipboard"></i>
                            </button>
                            <nav>
                                <ul id="pagination" class="pagination pagination-sm mb-0"></ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <div class="card p-4">
                    <h5 class="fw-bold mb-4"><i class="bi bi-bar-chart-line me-2"></i>Visualization Preview</h5>
                    <div class="row g-3 mb-4 p-3 bg-light rounded-3">
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Chart Type</label>
                            <select id="chartType" class="form-select">
                                <option value="bar" selected>Bar Chart</option>
                                <option value="line">Line Chart</option>
                                <option value="pie">Pie Chart</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">X Axis (Categories)</label>
                            <select id="chartX" class="form-select">
                                <option value="">Select Column</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Y Axis (Values)</label>
                            <select id="chartY" class="form-select">
                                <option value="">Select Column</option>
                            </select>
                        </div>
                    </div>

                    <div class="chart-wrap bg-white p-3 border rounded mb-4" style="min-height: 300px;">
                        <canvas id="chartCanvas"></canvas>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex gap-2">
                            <button id="renderChartBtn" class="btn btn-primary px-4">Generate Chart</button>
                        </div>
                        <small class="text-muted fst-italic">Note: Y-Axis must be a numeric column.</small>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <footer class="qd-footer text-center">
        <div class="container">
            <p class="mb-1">© 2025 <strong>QBITRIX DataLens</strong>. All rights reserved.</p>
            <small>Crafted by <a href="https://sachinkumarhebri.vercel.app" target="_blank"
                    class="text-decoration-none">Sachin Kumar</a></small>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="/js/app.js"></script>
    <script src="/js/dataExplorer/state.js"></script>
    <script src="/js/dataExplorer/utils.js"></script>
    <script src="/js/dataExplorer/db.js"></script>
    <script src="/js/dataExplorer/parser.js"></script>
    <script src="/js/dataExplorer/ui.js"></script>
    <script src="/js/dataExplorer/filters.js"></script>
    <script src="/js/dataExplorer/table.js"></script>
    <script src="/js/dataExplorer/exports.js"></script>
    <script src="/js/dataExplorer/chart.js"></script>
    <script src="/js/dataExplorer/events.js"></script>
    <script src="/js/dataExplorer/main.js"></script>
</body>

</html>