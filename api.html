<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qbitrix DataLens — API Explorer</title>

  <link rel="icon" type="image/png" href="assets/DataLensIco.ico" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <style>
    body {
      background: #f8f9fa;
      padding: 1rem;
      font-family: 'Segoe UI', sans-serif;
    }

    .app-card {
      background: #fff;
      border-radius: 10px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .table-wrapper {
      max-height: 60vh;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 8px;
    }

    thead th {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2;
    }

    .header h4 {
      color: #022260;
      font-weight: bold;
    }

    .form-label {
      font-weight: 600;
    }

    .response-section {
      margin-top: 20px;
    }

    footer {
      margin-top: 30px;
      text-align: center;
      font-size: 14px;
      color: #6c757d;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header d-flex justify-content-between align-items-center mb-4">
      <h4><span style="color:#022260;">Data</span><span style="color:#0eb0e3;">Lens</span> — API Explorer</h4>
      <a href="index.html" class="btn btn-outline-primary btn-sm"><i class="bi bi-arrow-left"></i> Back to DataLens</a>
    </div>

    <div class="app-card">
      <!-- Request Section -->
      <div class="row g-3 mb-3">
        <div class="col-md-3">
          <label class="form-label">HTTP Method</label>
          <select id="method" class="form-select">
            <option>GET</option>
            <option>POST</option>
            <option>PUT</option>
            <option>DELETE</option>
            <option>PATCH</option>
          </select>
        </div>
        <div class="col-md-9">
          <label class="form-label">Request URL</label>
          <input type="text" id="apiUrl" class="form-control" placeholder="Enter API endpoint (e.g., https://jsonplaceholder.typicode.com/posts)">
        </div>
      </div>

      <!-- Headers Section -->
      <div class="mb-3">
        <label class="form-label">Headers</label>
        <div id="headersContainer"></div>
        <button class="btn btn-outline-secondary btn-sm mt-2" id="addHeader"><i class="bi bi-plus-circle"></i> Add Header</button>
      </div>

      <!-- Body Section -->
      <div class="mb-3">
        <label class="form-label">Request Body (JSON)</label>
        <textarea id="requestBody" class="form-control" rows="5" placeholder='{"key":"value"}'></textarea>
      </div>

      <div class="d-flex justify-content-end">
        <button id="sendRequest" class="btn btn-primary"><i class="bi bi-send"></i> Send Request</button>
      </div>

      <!-- Response Section -->
      <div class="response-section">
        <h5 class="mt-4 mb-3">Response</h5>
        <div class="table-wrapper">
          <table class="table table-hover table-striped align-middle mb-0">
            <thead id="responseHead"></thead>
            <tbody id="responseBody"></tbody>
          </table>
        </div>
        <pre id="rawResponse" class="mt-3 bg-light p-2 rounded small text-wrap text-break"></pre>
      </div>
    </div>

    <footer>
      <p>© 2025 Qbitrix DataLens — API Explorer. Created by <a href="https://sachinkumarhebri.vercel.app" target="_blank">Sachin Kumar</a></p>
    </footer>
  </div>

  <script>
    const addHeaderBtn = document.getElementById("addHeader");
    const headersContainer = document.getElementById("headersContainer");
    const sendBtn = document.getElementById("sendRequest");
    const responseHead = document.getElementById("responseHead");
    const responseBody = document.getElementById("responseBody");
    const rawResponse = document.getElementById("rawResponse");

    // Add a header input row
    function addHeaderRow(key = "", value = "") {
      const row = document.createElement("div");
      row.classList.add("input-group", "mb-2");
      row.innerHTML = `
        <input type="text" class="form-control header-key" placeholder="Header Name" value="${key}">
        <input type="text" class="form-control header-value" placeholder="Header Value" value="${value}">
        <button class="btn btn-outline-danger removeHeader"><i class="bi bi-x"></i></button>
      `;
      headersContainer.appendChild(row);

      row.querySelector(".removeHeader").onclick = () => row.remove();
    }

    addHeaderBtn.onclick = () => addHeaderRow();

    // Send API request
    sendBtn.onclick = async () => {
      const url = document.getElementById("apiUrl").value.trim();
      const method = document.getElementById("method").value;
      const body = document.getElementById("requestBody").value.trim();

      if (!url) {
        alert("Please enter a valid API URL");
        return;
      }

      const headers = {};
      document.querySelectorAll(".header-key").forEach((keyInput, i) => {
        const key = keyInput.value.trim();
        const value = document.querySelectorAll(".header-value")[i].value.trim();
        if (key) headers[key] = value;
      });

      let options = { method, headers };

      if (["POST", "PUT", "PATCH"].includes(method) && body) {
        try {
          options.body = JSON.stringify(JSON.parse(body));
          headers["Content-Type"] = "application/json";
        } catch (err) {
          alert("Invalid JSON body");
          return;
        }
      }

      try {
        const response = await fetch(url, options);
        const data = await response.json();

        rawResponse.textContent = JSON.stringify(data, null, 2);

        if (Array.isArray(data)) renderTable(data);
        else if (typeof data === "object") renderTable([data]);
        else renderTable([{ response: data }]);
      } catch (error) {
        rawResponse.textContent = "Error: " + error;
        renderTable([]);
      }
    };

    // Render JSON as table
    function renderTable(data) {
      responseHead.innerHTML = "";
      responseBody.innerHTML = "";

      if (!data || data.length === 0) {
        responseHead.innerHTML = "<tr><th>No Data</th></tr>";
        return;
      }

      const columns = Object.keys(data[0]);
      responseHead.innerHTML = `<tr>${columns.map(c => `<th>${c}</th>`).join("")}</tr>`;

      responseBody.innerHTML = data.map(row => `
        <tr>${columns.map(c => `<td>${JSON.stringify(row[c])}</td>`).join("")}</tr>
      `).join("");
    }
  </script>
</body>

</html>
